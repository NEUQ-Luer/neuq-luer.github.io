{"title":"ORACLE之金额根据币种编号","date":"2019-08-01T01:03:38.000Z","thumbnail":"/img//BingPaper5.jpg","link":"post/ORACLE之金额根据币种编号","tags":["ORACLE"],"categories":["技术向"],"updated":"2019-08-01T01:33:30.255Z","content":"<p>币种为‘CNY’时金额保留两位小数，币种为‘BHD’时显示三位小数，有两种方法可以实现：  </p>\n<ol>\n<li><p>用代码根据币种动态控制格式掩码  </p>\n<p> 设：  </p>\n<p> Block：TEST<br> Item：AMOUNT<br> 在块TEST的Post-query里加入如下代码：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">APP_ITEM_PROPERTY.SET_PROPERTY(&apos;TEST.AMOUNT&apos;, --需要格式化的Item</span><br><span class=\"line\">FORMAT_MASK,</span><br><span class=\"line\">FND_CURRENCY.GET_FORMAT_MASK(</span><br><span class=\"line\">/*格式化用的币种，如果想用本位币可以这样取得</span><br><span class=\"line\">Select currency_code </span><br><span class=\"line\">Into l_currency_code</span><br><span class=\"line\">From gl_sets_of_books</span><br><span class=\"line\">Where set_of_books_id = fnd_profile(‘GL_SET_OF_BOOKS_ID’);</span><br><span class=\"line\">*/</span><br><span class=\"line\">‘USD’,</span><br><span class=\"line\">GET_ITEM_PROPERTY(&apos;TEST.AMOUNT&apos;, --返回Item的长度</span><br><span class=\"line\">MAX_LENGTH)));</span><br></pre></td></tr></table></figure>\n\n<p> 这种方法简单，但如果是一个块显示为多行数据，每行的币种不同的话，就不起作用了。</p>\n</li>\n<li><p>用函数APP_CURRENCY.Line_Dyn_Currency实现，这种方法可以实现多行不同币种的格式化</p>\n<p>设：<br>Block：TEST<br>Item：AMOUNT<br>每行的币种为Item CURRENCY_CODE在数据块中新建一个非数据库描述字段DESC，AMOUNT不显示，显示DESC.  </p>\n<p>在块TEST的’post-query’里加入如下代码：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">:TEST.DESC := TEST.DESC;</span><br><span class=\"line\">APP_CURRENCY.Line_Dyn_Currency(:TEST.CURRENCY_CODE, &apos;TEST.AMOUNT&apos;, &apos;TEST.DESC&apos;, &apos;POST-QUERY&apos;);</span><br></pre></td></tr></table></figure>\n\n<p>在Item：DESC的WHEN-VALIDATE-ITEM里添加如下代码：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">APP_CURRENCY.Line_Dyn_Currency(:TEST.CURRENCY_CODE, &apos;TEST.AMOUNT&apos;,</span><br><span class=\"line\">&apos;TEST.DESC&apos;, &apos;WHEN-VALIDATE-ITEM&apos;);</span><br><span class=\"line\">-- 它的作用是当DESC改变之后重新设置。</span><br></pre></td></tr></table></figure>\n\n<p>当然这种方法也有它的缺限，在块上查询之后用户没有操作，当前块的状态变成‘CHANGED’因显示AMOUNT时函数会APP_CURRENCY.Line_Dyn_Currency对AMOUNT重新赋值。解决以上问题，可以在块TEST的 post-query里加 APP_RECORD.SET_STATUS(‘QUERY’)，把块的状态改回来。</p>\n</li>\n</ol>\n<hr>\n<p><a href=\"https://blog.csdn.net/cunxiyuan108/article/details/6339694\" target=\"_blank\" rel=\"noopener\">原文：https://blog.csdn.net/cunxiyuan108/article/details/6339694</a></p>\n","next":{"title":"ORACLE行金额自动汇总到头","link":"post/ORACLE行金额自动汇总到头"},"plink":"http://luer.cf/post/ORACLE之金额根据币种编号/"}